# Validity and validity-based testing

[![Build Status](https://travis-ci.org/NorfairKing/validity.svg?branch=master)](https://travis-ci.org/NorfairKing/validity)

| Package  | Hackage  | Stackage |
|---|---|---|
| validity  | [![Hackage](https://img.shields.io/hackage/v/validity.svg)](https://hackage.haskell.org/package/validity) | [![Stackage](https://www.stackage.org/package/validity/badge/lts)](https://www.stackage.org/package/validity)  |
| validity-aeson |  [![Hackage](https://img.shields.io/hackage/v/validity-aeson.svg)](https://hackage.haskell.org/package/validity-aeson) | [![Stackage](https://www.stackage.org/package/validity-aeson/badge/lts)](https://www.stackage.org/package/validity-aeson) |
| validity-bytestring |  [![Hackage](https://img.shields.io/hackage/v/validity-bytestring.svg)](https://hackage.haskell.org/package/validity-bytestring) | [![Stackage](https://www.stackage.org/package/validity-bytestring/badge/lts)](https://www.stackage.org/package/validity-bytestring) |
| validity-containers |  [![Hackage](https://img.shields.io/hackage/v/validity-containers.svg)](https://hackage.haskell.org/package/validity-containers) | [![Stackage](https://www.stackage.org/package/validity-containers/badge/lts)](https://www.stackage.org/package/validity-containers) |
| validity-path |  [![Hackage](https://img.shields.io/hackage/v/validity-path.svg)](https://hackage.haskell.org/package/validity-path) | [![Stackage](https://www.stackage.org/package/validity-path/badge/lts)](https://www.stackage.org/package/validity-path) |
| validity-persistent | [![Hackage](https://img.shields.io/hackage/v/validity-persistent.svg)](https://hackage.haskell.org/package/validity-persistent) | [![Stackage](https://www.stackage.org/package/validity-persistent/badge/lts)](https://www.stackage.org/package/validity-persistent) |
| validity-primitive |  [![Hackage](https://img.shields.io/hackage/v/validity-primitive.svg)](https://hackage.haskell.org/package/validity-primitive) | [![Stackage](https://www.stackage.org/package/validity-primitive/badge/lts)](https://www.stackage.org/package/validity-primitive) |
| validity-scientific |  [![Hackage](https://img.shields.io/hackage/v/validity-scientific.svg)](https://hackage.haskell.org/package/validity-scientific) | [![Stackage](https://www.stackage.org/package/validity-scientific/badge/lts)](https://www.stackage.org/package/validity-scientific) |
| validity-text |  [![Hackage](https://img.shields.io/hackage/v/validity-text.svg)](https://hackage.haskell.org/package/validity-text) | [![Stackage](https://www.stackage.org/package/validity-text/badge/lts)](https://www.stackage.org/package/validity-text) |
| validity-time |  [![Hackage](https://img.shields.io/hackage/v/validity-time.svg)](https://hackage.haskell.org/package/validity-time) | [![Stackage](https://www.stackage.org/package/validity-time/badge/lts)](https://www.stackage.org/package/validity-time) |
| validity-unordered-containers |  [![Hackage](https://img.shields.io/hackage/v/validity-unordered-containers.svg)](https://hackage.haskell.org/package/validity-unordered-containers) | [![Stackage](https://www.stackage.org/package/validity-unordered-containers/badge/lts)](https://www.stackage.org/package/validity-unordered-containers) |
| validity-uuid |  [![Hackage](https://img.shields.io/hackage/v/validity-uuid.svg)](https://hackage.haskell.org/package/validity-uuid) | [![Stackage](https://www.stackage.org/package/validity-uuid/badge/lts)](https://www.stackage.org/package/validity-uuid) |
| validity-vector |  [![Hackage](https://img.shields.io/hackage/v/validity-vector.svg)](https://hackage.haskell.org/package/validity-vector) | [![Stackage](https://www.stackage.org/package/validity-vector/badge/lts)](https://www.stackage.org/package/validity-vector) |
| genvalidity |  [![Hackage](https://img.shields.io/hackage/v/genvalidity.svg)](https://hackage.haskell.org/package/genvalidity) | [![Stackage](https://www.stackage.org/package/genvalidity/badge/lts)](https://www.stackage.org/package/genvalidity) |
| genvalidity-aeson | [![Hackage](https://img.shields.io/hackage/v/genvalidity-aeson.svg)](https://hackage.haskell.org/package/genvalidity-aeson) | [![Stackage](https://www.stackage.org/package/genvalidity-aeson/badge/lts)](https://www.stackage.org/package/genvalidity-aeson) |
| genvalidity-bytestring |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-bytestring.svg)](https://hackage.haskell.org/package/genvalidity-bytestring) | [![Stackage](https://www.stackage.org/package/genvalidity-bytestring/badge/lts)](https://www.stackage.org/package/genvalidity-bytestring) |
| genvalidity-containers |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-containers.svg)](https://hackage.haskell.org/package/genvalidity-containers) | [![Stackage](https://www.stackage.org/package/genvalidity-containers/badge/lts)](https://www.stackage.org/package/genvalidity-containers) |
| genvalidity-criterion |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-criterion.svg)](https://hackage.haskell.org/package/genvalidity-criterion) | [![Stackage](https://www.stackage.org/package/genvalidity-criterion/badge/lts)](https://www.stackage.org/package/genvalidity-criterion) |
| genvalidity-path |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-path.svg)](https://hackage.haskell.org/package/genvalidity-path) | [![Stackage](https://www.stackage.org/package/genvalidity-path/badge/lts)](https://www.stackage.org/package/genvalidity-path) |
| genvalidity-persistent | [![Hackage](https://img.shields.io/hackage/v/genvalidity-persistent.svg)](https://hackage.haskell.org/package/genvalidity-persistent) | [![Stackage](https://www.stackage.org/package/genvalidity-persistent/badge/lts)](https://www.stackage.org/package/genvalidity-persistent) |
| genvalidity-property |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-property.svg)](https://hackage.haskell.org/package/genvalidity-property) | [![Stackage](https://www.stackage.org/package/genvalidity-property/badge/lts)](https://www.stackage.org/package/genvalidity-property) |
| genvalidity-scientific |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-scientific.svg)](https://hackage.haskell.org/package/genvalidity-scientific) | [![Stackage](https://www.stackage.org/package/genvalidity-scientific/badge/lts)](https://www.stackage.org/package/genvalidity-scientific) |
| genvalidity-text |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-text.svg)](https://hackage.haskell.org/package/genvalidity-text) | [![Stackage](https://www.stackage.org/package/genvalidity-text/badge/lts)](https://www.stackage.org/package/genvalidity-text) |
| genvalidity-time |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-time.svg)](https://hackage.haskell.org/package/genvalidity-time) | [![Stackage](https://www.stackage.org/package/genvalidity-time/badge/lts)](https://www.stackage.org/package/genvalidity-time) |
| genvalidity-unordered-containers |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-unordered-containers.svg)](https://hackage.haskell.org/package/genvalidity-unordered-containers) | [![Stackage](https://www.stackage.org/package/genvalidity-unordered-containers/badge/lts)](https://www.stackage.org/package/genvalidity-unordered-containers) |
| genvalidity-uuid |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-uuid.svg)](https://hackage.haskell.org/package/genvalidity-uuid) | [![Stackage](https://www.stackage.org/package/genvalidity-uuid/badge/lts)](https://www.stackage.org/package/genvalidity-uuid) |
| genvalidity-vector |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-vector.svg)](https://hackage.haskell.org/package/genvalidity-vector) | [![Stackage](https://www.stackage.org/package/genvalidity-vector/badge/lts)](https://www.stackage.org/package/genvalidity-vector) |
| genvalidity-hspec |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-hspec.svg)](https://hackage.haskell.org/package/genvalidity-hspec) | [![Stackage](https://www.stackage.org/package/genvalidity-hspec/badge/lts)](https://www.stackage.org/package/genvalidity-hspec) |
| genvalidity-hspec-aeson |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-hspec-aeson.svg)](https://hackage.haskell.org/package/genvalidity-hspec-aeson) | [![Stackage](https://www.stackage.org/package/genvalidity-hspec-aeson/badge/lts)](https://www.stackage.org/package/genvalidity-hspec-aeson) |
| genvalidity-hspec-binary |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-hspec-binary.svg)](https://hackage.haskell.org/package/genvalidity-hspec-binary) | [![Stackage](https://www.stackage.org/package/genvalidity-hspec-binary/badge/lts)](https://www.stackage.org/package/genvalidity-hspec-binary) |
| genvalidity-hspec-cereal |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-hspec-cereal.svg)](https://hackage.haskell.org/package/genvalidity-hspec-cereal) | [![Stackage](https://www.stackage.org/package/genvalidity-hspec-cereal/badge/lts)](https://www.stackage.org/package/genvalidity-hspec-cereal) |
| genvalidity-hspec-hashable |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-hspec-hashable.svg)](https://hackage.haskell.org/package/genvalidity-hspec-hashable) | [![Stackage](https://www.stackage.org/package/genvalidity-hspec-hashable/badge/lts)](https://www.stackage.org/package/genvalidity-hspec-hashable) |
| genvalidity-hspec-persistent | [![Hackage](https://img.shields.io/hackage/v/genvalidity-hspec-persistent.svg)](https://hackage.haskell.org/package/genvalidity-hspec-persistent) | [![Stackage](https://www.stackage.org/package/genvalidity-hspec-persistent/badge/lts)](https://www.stackage.org/package/genvalidity-hspec-persistent) |
| genvalidity-hspec-optics | [![Hackage](https://img.shields.io/hackage/v/genvalidity-hspec-optics.svg)](https://hackage.haskell.org/package/genvalidity-hspec-optics) | [![Stackage](https://www.stackage.org/package/genvalidity-hspec-optics/badge/lts)](https://www.stackage.org/package/genvalidity-hspec-optics) |
| genvalidity-sydtest |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-sydtest.svg)](https://hackage.haskell.org/package/genvalidity-sydtest) | [![Stackage](https://www.stackage.org/package/genvalidity-sydtest/badge/lts)](https://www.stackage.org/package/genvalidity-sydtest) |
| genvalidity-sydtest-aeson |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-sydtest-aeson.svg)](https://hackage.haskell.org/package/genvalidity-sydtest-aeson) | [![Stackage](https://www.stackage.org/package/genvalidity-sydtest-aeson/badge/lts)](https://www.stackage.org/package/genvalidity-sydtest-aeson) |
| genvalidity-sydtest-binary |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-sydtest-binary.svg)](https://hackage.haskell.org/package/genvalidity-sydtest-binary) | [![Stackage](https://www.stackage.org/package/genvalidity-sydtest-binary/badge/lts)](https://www.stackage.org/package/genvalidity-sydtest-binary) |
| genvalidity-sydtest-cereal |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-sydtest-cereal.svg)](https://hackage.haskell.org/package/genvalidity-sydtest-cereal) | [![Stackage](https://www.stackage.org/package/genvalidity-sydtest-cereal/badge/lts)](https://www.stackage.org/package/genvalidity-sydtest-cereal) |
| genvalidity-sydtest-hashable |  [![Hackage](https://img.shields.io/hackage/v/genvalidity-sydtest-hashable.svg)](https://hackage.haskell.org/package/genvalidity-sydtest-hashable) | [![Stackage](https://www.stackage.org/package/genvalidity-sydtest-hashable/badge/lts)](https://www.stackage.org/package/genvalidity-sydtest-hashable) |
| genvalidity-sydtest-persistent | [![Hackage](https://img.shields.io/hackage/v/genvalidity-sydtest-persistent.svg)](https://hackage.haskell.org/package/genvalidity-sydtest-persistent) | [![Stackage](https://www.stackage.org/package/genvalidity-sydtest-persistent/badge/lts)](https://www.stackage.org/package/genvalidity-sydtest-persistent) |
| genvalidity-sydtest-optics | [![Hackage](https://img.shields.io/hackage/v/genvalidity-sydtest-optics.svg)](https://hackage.haskell.org/package/genvalidity-sydtest-optics) | [![Stackage](https://www.stackage.org/package/genvalidity-sydtest-optics/badge/lts)](https://www.stackage.org/package/genvalidity-sydtest-optics) |


## Why?

> Make write correct software cheaper.

- Cheap properties
- Free generators
- Free shrinking

### Cheap properties

- Property Combinators:

``` haskell
specify "inverse functions" $ inverseFunctions (+1) (-1)
specify "equivalent functions" $ equivalent ((+ 1) . (- 1)) id
specify "transitivity" $ transitivity ((>) :: Int -> Int -> Bool)
specify "symmetry" $ symmetry ((==) :: Int -> Int -> Bool)
```

- Test suite combinators:

``` haskell
ordSpec @Int
```

```
  Ord Int
    (<=) :: Int -> Int -> Bool
      is reflexive for "even Int"'s
        +++ OK, passed 100 tests.
      is antisymmetric for "even Int"'s
        +++ OK, passed 100 tests.
      is transitive for "even Int"'s
        +++ OK, passed 100 tests.
      is equivalent to (\a b -> compare a b /= GT) for "even Int"'s
        +++ OK, passed 100 tests.
    (>=) :: Int -> Int -> Bool
      is reflexive for "even Int"'s
        +++ OK, passed 100 tests.
      is antisymmetric for "even Int"'s
        +++ OK, passed 100 tests.
      is transitive for "even Int"'s
        +++ OK, passed 100 tests.
      is equivalent to (\a b -> compare a b /= LT) for "even Int"'s
        +++ OK, passed 100 tests.
    (<) :: Int -> Int -> Bool
      is antireflexive for "even Int"'s
        +++ OK, passed 100 tests.
      is transitive for "even Int"'s
        +++ OK, passed 100 tests.
      is equivalent to (\a b -> compare a b == LT) for "even Int"'s
        +++ OK, passed 100 tests.
    (>) :: Int -> Int -> Bool
      is antireflexive for "even Int"'s
        +++ OK, passed 100 tests.
      is transitive for "even Int"'s
        +++ OK, passed 100 tests.
      is equivalent to (\a b -> compare a b == GT) for "even Int"'s
        +++ OK, passed 100 tests.
```

### Free generators

``` haskell
data MyType = MyType
  { myRational :: Rational
  , myBool :: Bool
  } deriving (Show, Eq, Generic)

instance Validity MyType -- Implementation is derived via Generic
instance GenUnchecked MyType -- Implementation is derived via Generic
instance GenValid MyType -- Default implementation via GenUnchecked and Validity
```

``` haskell
genValid :: Gen MyType -- Free access to a generator
```

### Free shrinking

``` haskell
shrinkValid :: MyType -> [MyType] -- Free access to a _valid_ shrinking function
```

## Further Documentation

- [Usage example](docs/USAGE_EXAMPLE.md)
- [Fully worked example](docs/FULLY_WORKED_EXAMPLE.md)
- [High-level package overview](docs/PACKAGE_OVERVIEW.md)


## Cachix cache

There is a [cachix](https://cachix.org) cache for this project.

To use it, use `cachix use validity` or add the appropriate details to your nixos configuration.

## Sponsor this project

Validity is free and open-source software.
Building it takes time, energy and money.
Please consider supporting the project at https://cs-syd.eu/support .
